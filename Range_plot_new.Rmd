---
title: "Range plots"
author: "LÃ©onard Jequier"
date: "21 novembre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Data
```{r}
mic = read.csv("MIC2.csv", header = T, sep = ";")
names(mic)[1] = "Country"
summary(mic)
```
### rearrenge data by date:
```{r}
mic$epi = paste( mic$Year, mic$Country, sep = "_")
mic = mic[order(mic$epi),]
mic$row = seq(1:length(mic$Country))


mic = mic[seq(1, length(mic$Country)-2),]
```

### Fluco - Deal with missing data
```{r}
mic$FL_min = log2(mic$FL_min)
mic$FL_max = log2(mic$FL_max)

for(i in seq(1:length(mic$Country))){
  if(!is.na(mic$FL_min[i]) & mic$FL_min[i] == mic$FL_max[i]) {
    mic$FL_min[i] = mic$FL_min[i] -0.05
    mic$FL_max[i] = mic$FL_max[i] +0.05
}
}


```

### Fluconazole - plot
```{r}
library("ggplot2")
#breakpoint glabrata = 32
png('fluco_same.png',height = 550 , width = 500)
par(mar=c(3,2,2,2))

pf = ggplot(mic) 

pf = pf +  geom_segment(aes(x=FL_min, 
                          y = row , xend=FL_max ,
                          yend = row),
                        show.legend = F,
                        size = 2,
                      colour = "cornflowerblue") 

pf2 = pf + scale_y_continuous(name = "",breaks = 1:length(mic$n) ,labels = as.character(mic$epi)) 

pf3 = pf2 + scale_x_continuous(name = "MIC",limits = c(-5.5, 8.5), breaks = seq(-5, 8), labels = c(2**seq(-5, 8)))

pf3 = pf3 + geom_vline(xintercept= (log2(32)), colour = "red", linetype = "dashed")+coord_fixed(0.7)

print(pf3)

dev.off()
```

### Casp - deal with NA
```{r}
mic$Casp_min = as.numeric(mic$Casp_min)
mic$Casp_max = as.numeric(mic$Casp_max)

mic$Casp_min = log2(mic$Casp_min)
mic$Casp_max = log2(mic$Casp_max)

mic$Casp_min == mic$Casp_max

for(i in seq(1:length(mic$Country))){
  if(!is.na(mic$Casp_min[i] == mic$Casp_max[i]) & mic$Casp_min[i] == mic$Casp_max[i]) {
    mic$Casp_min[i] = mic$Casp_min[i] -0.05
    mic$Casp_max[i] = mic$Casp_max[i] +0.05
}
}
```

### Caspo - plot 
```{r}

png('Caspo_same.png',height = 550 , width = 500)
par(mar=c(3,2,2,2))

pc = ggplot(mic) 

pc = pc +  geom_segment(aes(x=Casp_min, 
                          y = row , xend=Casp_max ,
                          yend = row),
                          size = 2,
                        show.legend = F,
                      colour = "cornflowerblue") 

pc2 = pc + scale_y_continuous(name = "", breaks = 1:length(mic$n) ,labels = rep(c(""), times = length(mic$n))) 

pc3 = pc2 + scale_x_continuous(name = "MIC",limits = c(-5.5, 8.5), breaks = seq(-5.0, 8.0) , labels = as.character(c(2**seq(-5, 8))))

pc3 = pc3 + geom_vline(xintercept= (log2(0.064)), colour = "red", linetype = "dashed") 
  
pc4 = pc3 + coord_fixed(0.7)

length(mic$n)
length(seq(-5.0, 8.0))
(1.6 * 14) / 32

print(pc4)

dev.off()
```

### AMB - deal with NA
```{r}
mic$AMB_min = as.numeric(mic$AMB_min)
mic$AMB_max = as.numeric(mic$AMB_max)

mic$AMB_min = log2(mic$AMB_min)
mic$AMB_max = log2(mic$AMB_max)

mic$AMB_min == mic$AMB_max

for(i in seq(1:length(mic$Country))){
  if(!is.na(mic$AMB_min[i] == mic$AMB_max[i]) & mic$AMB_min[i] == mic$AMB_max[i]) {
    mic$AMB_min[i] = mic$AMB_min[i] -0.05
    mic$AMB_max[i] = mic$AMB_max[i] +0.05
}
}
```

### AMB - plot 
```{r}
#breakpoint glabrata = 1

png('AMB_same.png',height = 550 , width = 500)
par(mar=c(3,2,2,2))

pa = ggplot(mic) 

pa = pa +  geom_segment(aes(x=AMB_min, 
                          y = row , xend=AMB_max ,
                          yend = row),
                           size = 2,
                        show.legend = F,
                      colour = "cornflowerblue") 

pa2 = pa + scale_y_continuous(name = "",breaks = 1:length(mic$n) ,labels = as.character(mic$epi)) 
pa3 = pa2 + scale_x_continuous(name = "MIC",limits = c(-5.5, 8.5), breaks = seq(-5.0, 8.0) , labels = as.character(c(2**seq(-5, 8))))

pa3 = pa3 + geom_vline(xintercept= (log2(1)), colour = "red", linetype = "dashed") + coord_fixed(0.7)
print(pa3)


dev.off()
```

### size
```{r}
png('size.png',height = 550 , width = 500)

s = ggplot(mic) 

s = s +  geom_segment(aes(x=rep(log10(0.9), time(length(n))), 
                          y = row , xend=log10(n) ,
                          yend = row
                            ),size = 2, show.legend = F,
                      colour = "cornflowerblue") 

s2 = s + scale_y_continuous(name = "", breaks = 1:length(mic$n) ,labels = rep(c(""), times = length(mic$n)))  
s3 = s2 + scale_x_continuous(name = "MIC",limits = c(log10(0.9), 2.6), breaks = log10(c(1,10,50,100, 200)), labels = c(1,10,50,100, 200))

(1.6 * 5) / 32

s4 = s3 + coord_fixed(0.1)

print(s4)
dev.off()
```

### all together now

```{r}
library("gridExtra")
library("gtable")
library(ggplot2)
library("grid")
png('arrenged.png',height = 650 , width = 500)
grid.arrange(pf3, pc3,pa3,s3, nrow = 2 )
dev.off()

png('arrenged2.png',height = 550 , width = 600)
g1 <- ggplotGrob(pf3)
g2 <- ggplotGrob(pc3)
g <- cbind(g1, g2, size = "first")
g$heights = unit.pmax(g1$heights, g2$heights)
grid.newpage()
grid.draw(g)
dev.off()

10** 1.5
```

